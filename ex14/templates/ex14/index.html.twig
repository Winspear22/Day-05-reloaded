{% extends 'base.html.twig' %}

{% block title %}ex14 â€“ SQL Injection Demo{% endblock %}

{% block content %}
    <h1>ex14 â€“ SQL Injection Demo</h1>

    {% if doesTableExist %}
        <div class="alert alert-success">âœ… Table "{{ tableName }}" exists.</div>
    {% else %}
        <div class="alert alert-danger">âŒ Table "{{ tableName }}" does not exist.</div>
    {% endif %}
    
    <form action="{{ path('ex14_create_table') }}" method="post" style="margin-bottom: 1em;">
        <button type="submit" style="background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 3px; cursor: pointer;">
            ğŸ“Š Create Table
        </button>
    </form>

    {% if doesTableExist %}
        <h2>ğŸš¨ Insert Comment (VULNERABLE)</h2>
        <form id="vuln-form" action="{{ path('ex14_insert_vulnerable_comment') }}" method="post" style="margin-bottom: 1em; padding: 10px; background: #ffe6e6; border: 1px solid #ff0000; border-radius: 3px;">
            <input type="text" name="comment" id="vuln-comment" placeholder="Enter comment (vulnerable to SQL injection)" style="width: 100%; padding: 8px; box-sizing: border-box;">
            <button type="submit" style="background: #dc3545; color: white; padding: 10px 20px; border: none; border-radius: 3px; cursor: pointer; margin-top: 10px;">
                âš ï¸ Insert (Vulnerable)
            </button>
        </form>
        <button type="button" onclick="injectSQL()" style="background: #ff9800; color: white; padding: 10px 20px; border: none; border-radius: 3px; cursor: pointer; margin-bottom: 1em;">
            ğŸ”¥ Try SQL Injection
        </button>

        <h2>âœ… Insert Comment (SECURE)</h2>
        <form action="{{ path('ex14_insert_secure_comment') }}" method="post" style="margin-bottom: 1em; padding: 10px; background: #e6ffe6; border: 1px solid #00aa00; border-radius: 3px;">
            <input type="text" name="comment" placeholder="Enter comment (protected)" style="width: 100%; padding: 8px; box-sizing: border-box;">
            <button type="submit" style="background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 3px; cursor: pointer; margin-top: 10px;">
                âœ… Insert (Secure)
            </button>
        </form>

        <h2>ğŸ“‹ All Comments</h2>
        <table border="1" style="width: 100%; margin-bottom: 2em; border-collapse: collapse;">
            <thead>
                <tr style="background: #007bff; color: white;">
                    <th style="padding: 10px;">ID</th>
                    <th style="padding: 10px;">Comment</th>
                </tr>
            </thead>
            <tbody>
                {% for c in comments %}
                    <tr>
                        <td style="padding: 10px;">{{ c.id }}</td>
                        <td style="padding: 10px;">{{ c.comment }}</td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="2" style="padding: 10px; text-align: center; font-style: italic;">No comments found</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% endif %}

    <script>
        function injectSQL()
        {
            const field = document.getElementById('vuln-comment');
            const payload = "'); DROP TABLE ex14_comments; --";
            
            field.value = payload;
            alert(`Injection payload entered:\n\n${payload}\n\nSubmit the form to execute the injection!`);
        }
    </script>
{% endblock %}
