================================================================================
PROJECT STRUCTURE OVERVIEW - ex10
================================================================================

Root Directory: ./ex10/

./ex10
â”œâ”€â”€ bin
â”‚Â Â  â””â”€â”€ console
â”œâ”€â”€ composer.json
â”œâ”€â”€ composer.lock
â”œâ”€â”€ config
â”‚Â Â  â”œâ”€â”€ bundles.php
â”‚Â Â  â”œâ”€â”€ packages
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ cache.yaml
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ doctrine_migrations.yaml
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ doctrine.yaml
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ framework.yaml
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ routing.yaml
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ twig.yaml
â”‚Â Â  â”‚Â Â  â””â”€â”€ validator.yaml
â”‚Â Â  â”œâ”€â”€ preload.php
â”‚Â Â  â”œâ”€â”€ routes
â”‚Â Â  â”‚Â Â  â””â”€â”€ framework.yaml
â”‚Â Â  â”œâ”€â”€ routes.yaml
â”‚Â Â  â””â”€â”€ services.yaml
â”œâ”€â”€ migrations
â”‚Â Â  â””â”€â”€ Version20251110134744.php
â”œâ”€â”€ public
â”‚Â Â  â”œâ”€â”€ index.php
â”‚Â Â  â””â”€â”€ style.css
â”œâ”€â”€ src
â”‚Â Â  â”œâ”€â”€ Controller
â”‚Â Â  â”‚Â Â  â””â”€â”€ Ex10Controller.php
â”‚Â Â  â”œâ”€â”€ Entity
â”‚Â Â  â”‚Â Â  â””â”€â”€ Data.php
â”‚Â Â  â”œâ”€â”€ Kernel.php
â”‚Â Â  â”œâ”€â”€ Repository
â”‚Â Â  â”‚Â Â  â””â”€â”€ DataRepository.php
â”‚Â Â  â””â”€â”€ Service
â”‚Â Â      â”œâ”€â”€ CreateTableServiceORM.php
â”‚Â Â      â”œâ”€â”€ CreateTableServiceSQL.php
â”‚Â Â      â”œâ”€â”€ DeleteAllDataService.php
â”‚Â Â      â”œâ”€â”€ DeleteDataServiceORM.php
â”‚Â Â      â”œâ”€â”€ DeleteDataServiceSQL.php
â”‚Â Â      â”œâ”€â”€ ImportFileService.php
â”‚Â Â      â”œâ”€â”€ InsertDataServiceORM.php
â”‚Â Â      â”œâ”€â”€ InsertDataServiceSQL.php
â”‚Â Â      â”œâ”€â”€ ReadDataServiceORM.php
â”‚Â Â      â”œâ”€â”€ ReadDataServiceSQL.php
â”‚Â Â      â””â”€â”€ UtilsService.php
â”œâ”€â”€ symfony.lock
â”œâ”€â”€ templates
â”‚Â Â  â”œâ”€â”€ base.html.twig
â”‚Â Â  â”œâ”€â”€ bundles
â”‚Â Â  â”‚Â Â  â””â”€â”€ TwigBundle
â”‚Â Â  â””â”€â”€ ex10
â”‚Â Â      â””â”€â”€ index.html.twig
â”œâ”€â”€ text.txt
â”œâ”€â”€ var
â”‚Â Â  â”œâ”€â”€ cache
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ env
â”‚Â Â  â”‚Â Â  â””â”€â”€ prod
â”‚Â Â  â””â”€â”€ log
â””â”€â”€ vendor
    â”œâ”€â”€ autoload.php
    â”œâ”€â”€ autoload_runtime.php
    â”œâ”€â”€ bin
    â”‚Â Â  â”œâ”€â”€ doctrine-migrations
    â”‚Â Â  â”œâ”€â”€ patch-type-declarations
    â”‚Â Â  â”œâ”€â”€ php-parse
    â”‚Â Â  â”œâ”€â”€ sql-formatter
    â”‚Â Â  â”œâ”€â”€ var-dump-server
    â”‚Â Â  â””â”€â”€ yaml-lint
    â”œâ”€â”€ composer
    â”‚Â Â  â”œâ”€â”€ autoload_classmap.php
    â”‚Â Â  â”œâ”€â”€ autoload_files.php
    â”‚Â Â  â”œâ”€â”€ autoload_namespaces.php
    â”‚Â Â  â”œâ”€â”€ autoload_psr4.php
    â”‚Â Â  â”œâ”€â”€ autoload_real.php
    â”‚Â Â  â”œâ”€â”€ autoload_static.php
    â”‚Â Â  â”œâ”€â”€ ClassLoader.php
    â”‚Â Â  â”œâ”€â”€ installed.json
    â”‚Â Â  â”œâ”€â”€ installed.php
    â”‚Â Â  â”œâ”€â”€ InstalledVersions.php
    â”‚Â Â  â”œâ”€â”€ LICENSE
    â”‚Â Â  â””â”€â”€ platform_check.php
    â”œâ”€â”€ doctrine
    â”‚Â Â  â”œâ”€â”€ annotations
    â”‚Â Â  â”œâ”€â”€ collections
    â”‚Â Â  â”œâ”€â”€ dbal
    â”‚Â Â  â”œâ”€â”€ deprecations
    â”‚Â Â  â”œâ”€â”€ doctrine-bundle
    â”‚Â Â  â”œâ”€â”€ doctrine-migrations-bundle
    â”‚Â Â  â”œâ”€â”€ event-manager
    â”‚Â Â  â”œâ”€â”€ inflector
    â”‚Â Â  â”œâ”€â”€ instantiator
    â”‚Â Â  â”œâ”€â”€ lexer
    â”‚Â Â  â”œâ”€â”€ migrations
    â”‚Â Â  â”œâ”€â”€ orm
    â”‚Â Â  â”œâ”€â”€ persistence
    â”‚Â Â  â””â”€â”€ sql-formatter
    â”œâ”€â”€ nikic
    â”‚Â Â  â””â”€â”€ php-parser
    â”œâ”€â”€ psr
    â”‚Â Â  â”œâ”€â”€ cache
    â”‚Â Â  â”œâ”€â”€ container
    â”‚Â Â  â”œâ”€â”€ event-dispatcher
    â”‚Â Â  â””â”€â”€ log
    â”œâ”€â”€ symfony
    â”‚Â Â  â”œâ”€â”€ asset
    â”‚Â Â  â”œâ”€â”€ cache
    â”‚Â Â  â”œâ”€â”€ cache-contracts
    â”‚Â Â  â”œâ”€â”€ config
    â”‚Â Â  â”œâ”€â”€ console
    â”‚Â Â  â”œâ”€â”€ dependency-injection
    â”‚Â Â  â”œâ”€â”€ deprecation-contracts
    â”‚Â Â  â”œâ”€â”€ doctrine-bridge
    â”‚Â Â  â”œâ”€â”€ dotenv
    â”‚Â Â  â”œâ”€â”€ error-handler
    â”‚Â Â  â”œâ”€â”€ event-dispatcher
    â”‚Â Â  â”œâ”€â”€ event-dispatcher-contracts
    â”‚Â Â  â”œâ”€â”€ filesystem
    â”‚Â Â  â”œâ”€â”€ finder
    â”‚Â Â  â”œâ”€â”€ flex
    â”‚Â Â  â”œâ”€â”€ form
    â”‚Â Â  â”œâ”€â”€ framework-bundle
    â”‚Â Â  â”œâ”€â”€ http-foundation
    â”‚Â Â  â”œâ”€â”€ http-kernel
    â”‚Â Â  â”œâ”€â”€ maker-bundle
    â”‚Â Â  â”œâ”€â”€ options-resolver
    â”‚Â Â  â”œâ”€â”€ polyfill-intl-grapheme
    â”‚Â Â  â”œâ”€â”€ polyfill-intl-icu
    â”‚Â Â  â”œâ”€â”€ polyfill-intl-normalizer
    â”‚Â Â  â”œâ”€â”€ polyfill-mbstring
    â”‚Â Â  â”œâ”€â”€ polyfill-php83
    â”‚Â Â  â”œâ”€â”€ polyfill-php84
    â”‚Â Â  â”œâ”€â”€ process
    â”‚Â Â  â”œâ”€â”€ property-access
    â”‚Â Â  â”œâ”€â”€ property-info
    â”‚Â Â  â”œâ”€â”€ routing
    â”‚Â Â  â”œâ”€â”€ runtime
    â”‚Â Â  â”œâ”€â”€ service-contracts
    â”‚Â Â  â”œâ”€â”€ stopwatch
    â”‚Â Â  â”œâ”€â”€ string
    â”‚Â Â  â”œâ”€â”€ translation-contracts
    â”‚Â Â  â”œâ”€â”€ twig-bridge
    â”‚Â Â  â”œâ”€â”€ twig-bundle
    â”‚Â Â  â”œâ”€â”€ validator
    â”‚Â Â  â”œâ”€â”€ var-dumper
    â”‚Â Â  â”œâ”€â”€ var-exporter
    â”‚Â Â  â””â”€â”€ yaml
    â””â”€â”€ twig
        â”œâ”€â”€ extra-bundle
        â””â”€â”€ twig

91 directories, 57 files

================================================================================

ðŸ“‚ SOURCE CODE (src/) - Location: ex10/src/
================================================================================


---
File: src/Controller/Ex10Controller.php
---

<?php

namespace App\Controller;

use DateTime;
use Exception;
use App\Entity\Data;
use App\Service\CreateTableServiceORM;
use App\Service\CreateTableServiceSQL;
use App\Service\DeleteAllDataService;
use App\Service\ImportFileService;
use App\Service\ReadDataServiceORM;
use App\Service\ReadDataServiceSQL;
use App\Service\DeleteDataServiceORM;
use App\Service\DeleteDataServiceSQL;
use App\Service\InsertDataServiceORM;
use App\Service\InsertDataServiceSQL;
use Symfony\Component\HttpFoundation\Request;
use Symfony\Component\HttpFoundation\Response;
use Symfony\Component\Routing\Annotation\Route;
use Symfony\Component\Validator\Constraints\Length;
use Symfony\Component\Validator\Constraints\NotBlank;
use Symfony\Component\Form\Extension\Core\Type\TextType;
use Symfony\Bundle\FrameworkBundle\Controller\AbstractController;

class Ex10Controller extends AbstractController
{
    public function __construct(
        private readonly ReadDataServiceSQL $readSql,
        private readonly ReadDataServiceORM $readOrm,
        private readonly InsertDataServiceSQL $insertSql,
        private readonly InsertDataServiceORM $insertOrm,
        private readonly DeleteDataServiceSQL $deleteSql,
        private readonly DeleteDataServiceORM $deleteOrm,
        private readonly CreateTableServiceSQL $createSql,
        private readonly CreateTableServiceORM $createOrm,
        private readonly DeleteAllDataService $utils

    ) {}

    /**
     * @Route("/ex10", name="ex10_index", methods={"GET"})
     */
    public function index(): Response
    {
        $formSQL = $this->createDataForm();
        $formORM = $this->createDataForm();
        $tableNameSql = "ex10_data_sql";
        $tableNameOrm = "ex10_data_orm";
        try
        {
            $this->createSql->createTableSQL($tableNameSql).
            $this->createOrm->createTableORM($tableNameOrm);
            $dataSql = $this->readSql->readAllDataSQL($tableNameSql);
            $dataOrm = $this->readOrm->readAllDataORM($tableNameOrm);
        }
        catch (Exception $e)
        {
            $this->addFlash('danger', "Error, unexpected error: " . $e->getMessage());
            $dataSql = [];
            $dataOrm = [];
        }
        return $this->render('ex10/index.html.twig', [
            'formSQL' => $formSQL->createView(),
            'formORM' => $formORM->createView(),
            'datasSQL' => $dataSql,
            'datasORM' => $dataOrm
        ]);
    }

    /**
     * @Route("/ex10/insert_data_sql", name="ex10_insert_data_sql", methods={"POST"})
     */
    public function insertDataSQL(Request $request): Response
    {
        try
        {
            $form = $this->createDataForm();
            $form->handleRequest($request);
            if ($form->isSubmitted() && $form->isValid())
            {
                $data = $form->get('comment')->getData();
                $date = new DateTime();
                $result = $this->insertSql->insertDataSQL("ex10_data_sql", $data, $date);//$dataInsertService->insertData($connection, 'ex10_data_sql', $data, $date);
                [$type, $msg] = explode(':', $result, 2);
                $this->addFlash($type, $msg);
                return $this->redirectToRoute('ex10_index');
            }
            else
            {
                $this->addFlash('danger', 'Error, invalid form!');
                return $this->redirectToRoute('ex10_index');
            }
        }
        catch (Exception $e)
        {
            $this->addFlash('danger', 'Error, unexpected error while inserting data: ' . $e->getMessage());
            return $this->redirectToRoute('ex10_index');
        }
    }

    /**
     * @Route("/ex10/insert_data_orm", name="ex10_insert_data_orm", methods={"POST"})
     */
    public function insertDataORM(Request $request): Response
    {
        try
        {
            $form = $this->createDataForm();
            $form->handleRequest($request);
            if ($form->isSubmitted() && $form->isValid())
            {
                $comment = $form->get('comment')->getData();
                $dataEntity = new Data();
                $dataEntity->setData($comment);
                $dataEntity->setDate(new DateTime());
                $result = $this->insertOrm->insertDataORM("ex10_data_orm", $dataEntity);
                [$type, $msg] = explode(':', $result, 2);
                $this->addFlash($type, $msg);
                return $this->redirectToRoute('ex10_index');
            }
            else
            {
                $this->addFlash('danger', 'Error, invalid form!');
                return $this->redirectToRoute('ex10_index');
            }
        }
        catch(Exception $e)
        {
            $this->addFlash('danger', 'Error, unexpected error while inserting data: ' . $e->getMessage());
            return $this->redirectToRoute('ex10_index');
        }
    }

    /**
     * @Route("/ex10/delete_data_sql/{id}", name="ex10_delete_data_sql", methods={"POST"})
     */
    public function deleteDataSQL(int $id): Response
    {
        try
        {
            $result = $this->deleteSql->deleteDataByIdSQL("ex10_data_sql", $id);
            [$type, $msg] = explode(':', $result, 2);
            $this->addFlash($type, $msg);
            return $this->redirectToRoute('ex10_index');

        }
        catch (Exception $e)
        {
            $this->addFlash('danger', "Unexpected error while deleting data: " . $e->getMessage());
            return $this->redirectToRoute('ex10_index');
        }
    }

    /**
     * @Route("/ex10/delete_all_data_sql", name="ex10_delete_all_data_sql", methods={"POST"})
     */
    public function deleteAllDataSQL(): Response
    {
        $tableName = "ex10_data_sql";
        try
        {
            $result = $this->deleteSql->deleteAllDataSQL($tableName);
            [$type, $msg] = explode(':', $result, 2);
            $this->addFlash($type, $msg);
            return $this->redirectToRoute('ex10_index');
        }
        catch (Exception $e)
        {
            $this->addFlash('danger', 'Error, unexpected error: ' . $e->getMessage());
            return $this->redirectToRoute('ex10_index');
        }
    }

    /**
     * @Route("/ex10/delete_data_orm/{id}", name="ex10_delete_data_orm", methods={"POST"})
     */
    public function deleteDataORM(int $id): Response
    {
        try
        {
            $result = $this->deleteOrm->deleteDataByIdORM("ex10_data_orm", $id);
            [$type, $msg] = explode(':', $result, 2);
            $this->addFlash($type, $msg);
            return $this->redirectToRoute('ex10_index');
        }
        catch (Exception $e)
        {
            $this->addFlash('danger', 'Error, unexpected error: ' . $e->getMessage());
            return $this->redirectToRoute('ex10_index');
        }
    }
        
    /**
     * @Route("/ex10/delete_all_data_orm", name="ex10_delete_all_data_orm", methods={"POST"})
     */
    public function deleteAllDataORM(): Response
    {
        $tableName = "ex10_data_orm";
        try
        {
            $result = $this->deleteOrm->deleteAllDataORM($tableName);
            [$type, $msg] = explode(':', $result, 2);
            $this->addFlash($type, $msg);
            return $this->redirectToRoute('ex10_index');
        }
        catch (Exception $e)
        {
            $this->addFlash('danger', 'Error, unexpected error: ' . $e->getMessage());
            return $this->redirectToRoute('ex10_index');
        }
    }

    /**
     * @Route("/ex10/delete_all", name="ex10_delete_all", methods={"POST"})
     */
    public function deleteAll(): Response
    {
        $tableNameSql = "ex10_data_sql";
        $tableNameOrm = "ex10_data_orm";
        $result = $this->utils->deleteAllData($tableNameSql, $tableNameOrm);
        
        if ($result['success'])
            $this->addFlash('success', $result['message']);
        else
            $this->addFlash('danger', $result['message']);
        
        return $this->redirectToRoute('ex10_index');
    }

    private function createDataForm()
    {
        return $this->createFormBuilder()
            ->add('comment', TextType::class, [
                'label' => 'Comment',
                'constraints' => [
                    new NotBlank(['message' => 'Comment is required.']),
                    new Length(['max' => 255, 'maxMessage' => 'Maximum 255 characters allowed.']),
                ],
                'attr' => ['maxlength' => 255, 'placeholder' => 'Your comment']
            ])
            ->getForm();
    }

    /**
     * @Route("/ex10/import", name="ex10_import_file", methods={"POST"})
     */
    public function importFile(ImportFileService $importFileService): Response
    {
        try
        {
            $filePath = $this->getParameter('kernel.project_dir') . '/text.txt';

            if (!is_file($filePath))
            {
                $this->addFlash('danger', 'Error: The file path is invalid or is a directory.');
                return $this->redirectToRoute('ex10_index');
            }

            if (!is_readable($filePath))
            {
                $this->addFlash('danger', 'Error: The file is not readable. Check file permissions.');
                return $this->redirectToRoute('ex10_index');
            }

            $result = $importFileService->importFile($filePath, 'ex10_data_sql');
            [$type, $msg] = explode(':', $result['message'], 2);
            $this->addFlash($type, $msg);
            return $this->redirectToRoute('ex10_index');
        }
        catch (Exception $e)
        {
            $this->addFlash('danger', 'An unexpected error occurred during import.');
            if ($this->getParameter('kernel.debug'))
                $this->addFlash('danger', 'Debug: ' . $e->getMessage());
            return $this->redirectToRoute('ex10_index');
        }
    }
}


---
File: src/Entity/Data.php
---

<?php

namespace App\Entity;

use App\Repository\DataRepository;
use Doctrine\ORM\Mapping as ORM;

#[ORM\Entity(repositoryClass: DataRepository::class)]
#[ORM\Table(name: "ex10_data_orm")]
class Data
{
    #[ORM\Id]
    #[ORM\GeneratedValue]
    #[ORM\Column]
    private ?int $id = null;

    #[ORM\Column(length: 255)]
    private ?string $data = null;

    #[ORM\Column]
    private ?\DateTime $date = null;

    public function getId(): ?int
    {
        return $this->id;
    }

    public function getData(): ?string
    {
        return $this->data;
    }

    public function setData(string $data): static
    {
        $this->data = $data;

        return $this;
    }

    public function getDate(): ?\DateTime
    {
        return $this->date;
    }

    public function setDate(\DateTime $date): static
    {
        $this->date = $date;

        return $this;
    }
}


---
File: src/Kernel.php
---

<?php

namespace App;

use Symfony\Bundle\FrameworkBundle\Kernel\MicroKernelTrait;
use Symfony\Component\HttpKernel\Kernel as BaseKernel;

class Kernel extends BaseKernel
{
    use MicroKernelTrait;
}


---
File: src/Repository/DataRepository.php
---

<?php

namespace App\Repository;

use App\Entity\Data;
use Doctrine\Bundle\DoctrineBundle\Repository\ServiceEntityRepository;
use Doctrine\Persistence\ManagerRegistry;

/**
 * @extends ServiceEntityRepository<Data>
 */
class DataRepository extends ServiceEntityRepository
{
    public function __construct(ManagerRegistry $registry)
    {
        parent::__construct($registry, Data::class);
    }

    //    /**
    //     * @return Data[] Returns an array of Data objects
    //     */
    //    public function findByExampleField($value): array
    //    {
    //        return $this->createQueryBuilder('d')
    //            ->andWhere('d.exampleField = :val')
    //            ->setParameter('val', $value)
    //            ->orderBy('d.id', 'ASC')
    //            ->setMaxResults(10)
    //            ->getQuery()
    //            ->getResult()
    //        ;
    //    }

    //    public function findOneBySomeField($value): ?Data
    //    {
    //        return $this->createQueryBuilder('d')
    //            ->andWhere('d.exampleField = :val')
    //            ->setParameter('val', $value)
    //            ->getQuery()
    //            ->getOneOrNullResult()
    //        ;
    //    }
}


---
File: src/Service/CreateTableServiceORM.php
---

<?php 

namespace App\Service;

use Exception;
use Doctrine\DBAL\Connection;
use Symfony\Component\Process\Process;

class CreateTableServiceORM
{
	public function __construct(
		private readonly UtilsService $utilsService
	) {}

	public function createTableORM(string $tableName): string
	{
		try
		{
			if ($this->utilsService->checkTableExistenceORM($tableName))
				return 'info: Table already exists.';
			$process = new Process([
				'php',
				'bin/console',
				'doctrine:migrations:migrate',
				'--no-interaction'
			]);
			$process->setWorkingDirectory(__DIR__ . '/../../');
			$process->run();
			if ($process->isSuccessful())
				return 'success: Table created successfully!';
			else
				return 'error: ' . $process->getErrorOutput();
		} 
		catch (Exception $e)
		{
			return 'error: ' . $e->getMessage();
		}
	}
}
?>

---
File: src/Service/CreateTableServiceSQL.php
---

<?php 

namespace App\Service;

use App\Service\UtilsService;
use Doctrine\DBAL\Connection;

class CreateTableServiceSQL
{
	public function __construct(
		private readonly Connection $sql_connection,
		private readonly UtilsService $utils_service) {}

	public function createTableSQL(string $tableName): string
	{
		$sql = "CREATE TABLE IF NOT EXISTS $tableName (
			id INT AUTO_INCREMENT PRIMARY KEY,
			data VARCHAR(255) NOT NULL,
			date DATETIME NOT NULL
		);";
		try
		{
			if ($this->utils_service->checkTableExistenceSQL($tableName))
				return "info:The table $tableName already exists and cannot be created again.";
			$this->sql_connection->executeStatement($sql);
			return "success:Success! The table $tableName was created!";
		}
		catch (\Exception $e)
		{
			return "danger:Error! The table $tableName could not be created. " . $e->getMessage();
		}
	}
}
?>

---
File: src/Service/DeleteAllDataService.php
---

<?php

namespace App\Service;

use Exception;
use Doctrine\DBAL\Connection;
use App\Service\DeleteDataServiceORM;
use App\Service\DeleteDataServiceSQL;

class DeleteAllDataService
{
	public function __construct(
		private readonly DeleteDataServiceSQL $deleteSql,
        private readonly DeleteDataServiceORM $deleteOrm

	) {}
	public function deleteAllData(string $tableNameSql, string $tableNameOrm): array
	{
		try
		{
			$resultSql = $this->deleteSql->deleteAllDataSQL($tableNameSql);
			$resultOrm = $this->deleteOrm->deleteAllDataORM($tableNameOrm);
			
			[$typeSql, $msgSql] = explode(':', $resultSql, 2);
			[$typeOrm, $msgOrm] = explode(':', $resultOrm, 2);
			
			if ($typeSql === 'danger' || $typeOrm === 'danger')
			{
				return [
					'success' => false,
					'type' => 'danger',
					'message' => "Error deleting data | SQL: $msgSql | ORM: $msgOrm"
				];
			}
			
			return [
				'success' => true,
				'message' => 'All data deleted successfully from both SQL and ORM!',
				'sql' => $resultSql,
				'orm' => $resultOrm
			];
		}
		catch (Exception $e)
		{
			return [
				'success' => false,
				'message' => 'Error deleting all data: ' . $e->getMessage()
			];
		}
	}
}

---
File: src/Service/DeleteDataServiceORM.php
---

<?php

namespace App\Service;

use Exception;
use App\Service\UtilsService;
use App\Repository\DataRepository;
use Doctrine\ORM\EntityManagerInterface;

class DeleteDataServiceORM
{
	public function __construct(
		private readonly DataRepository $data_repository,
		private readonly EntityManagerInterface $em,
		private readonly UtilsService $utilsService

	) {}

	public function deleteDataByIdORM(string $tableName, int $id): string
	{
		try
		{
			if (!$this->utilsService->checkTableExistenceORM($tableName))
				return "info: Table $tableName does not exist.";
			$data = $this->data_repository->find($id);
			if (!$data)
				return "info: Data with ID $id not found.";
			$this->em->remove($data);
			$this->em->flush();
			return "success: Data with ID $id deleted successfully!";
		}
		catch (Exception $e)
		{
			return "danger: Error deleting data with ID $id. " . $e->getMessage();
		}
	}

	public function deleteAllDataORM(string $tableName): string
	{
		try
		{
			if (!$this->utilsService->checkTableExistenceORM($tableName))
				return "info: Table $tableName does not exist.";
			$datas = $this->data_repository->findAll();
			if (empty($datas))
				return "info: No data to delete.";
			foreach ($datas as $data)
				$this->em->remove($data);
			$this->em->flush();
			return "success: All data deleted successfully!";
		}
		catch (Exception $e)
		{
			return "danger: Error deleting all data. " . $e->getMessage();
		}
	}
}

---
File: src/Service/DeleteDataServiceSQL.php
---

<?php

namespace App\Service;

use Exception;
use App\Service\UtilsService;
use Doctrine\DBAL\Connection;
use App\Service\ReadDataServiceSQL;

class DeleteDataServiceSQL
{
	public function __construct(
		private readonly Connection $sql_connection,
		private readonly UtilsService $utils_service,
		private readonly ReadDataServiceSQL $read_service
	) {}

	public function deleteDataByIdSQL(string $tableName, int $id): string
	{
		$sql_command = "DELETE FROM $tableName WHERE id = :id";
		try
		{
			if (!$this->utils_service->checkTableExistenceSQL($tableName))
				return "info: The table $tableName does not exist.";
			if ($this->read_service->readDataByIdSQL($tableName, $id) === null)
				return "danger:Error, data $id does not exist.";
			$this->sql_connection->executeStatement($sql_command, ['id' => $id]);
			return "success:Success! Data $id deleted from $tableName.";
		}
		catch (Exception $e)
		{
            return "danger:Error while deleting data $id: " . $e->getMessage();
		}
	}

	public function deleteAllDataSQL(string $tableName): string
	{
		$sql_command = "DELETE FROM $tableName";
		try
		{
			if (!$this->utils_service->checkTableExistenceSQL($tableName))
				return "info: The table $tableName does not exist.";
			$this->sql_connection->executeStatement($sql_command);
			return "success:Success! All data deleted from $tableName.";
		}
		catch (Exception $e)
		{
			return "danger:Error while deleting all data: " . $e->getMessage();
		}
	}
}
?>

---
File: src/Service/ImportFileService.php
---

<?php

namespace App\Service;

use DateTime;
use Exception;
use App\Entity\Data;
use App\Service\UtilsService;
use Doctrine\DBAL\Connection;

class ImportFileService
{
	public function __construct(
		private readonly Connection $sql_connection,
		private readonly UtilsService $utils_service,
		private readonly InsertDataServiceORM $InsertDataServiceORM,
		private readonly InsertDataServiceSQL $insertDataServiceSQL,
		private readonly CreateTableServiceSQL $createTableServiceSQL,
		private readonly CreateTableServiceORM $createTableServiceORM,
	) {}
	

    public function importFile(string $filePath, string $tableName): array
    {
        try
        {
            if (!file_exists($filePath))
                return ['success' => false, 'message' => 'Error ! Could not find file: ' . basename($filePath)];
            
            $content = array_map(
                fn ($line) => htmlspecialchars($line, ENT_QUOTES | ENT_SUBSTITUTE, 'UTF-8'),
                file($filePath, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES)
            );
            
            if (empty($content))
                return ['success' => false, 'message' => 'Error ! The file is empty.'];
            
            $date = new DateTime();
            $this->createTableServiceSQL->createTableSQL($tableName);
            $this->createTableServiceORM->createTableORM($tableName);
            
            foreach ($content as $line)
                $this->insertDataServiceSQL->insertDataSQL($tableName, $line, $date);
            
            foreach ($content as $line)
            {
                $dataEntity = new Data();
                $dataEntity->setData($line);
                $dataEntity->setDate($date);
                $this->InsertDataServiceORM->insertDataORM($tableName, $dataEntity);
            }
            
            return ['success' => true, 'message' => 'Success! The SQL and ORM import was successful!'];
        }
        catch (Exception $e)
        {
            return ['success' => false, 'message' => 'Error during the file import: ' . $e->getMessage()];
        }
    }
}
?>

---
File: src/Service/InsertDataServiceORM.php
---

<?php

namespace App\Service;

use Exception;
use App\Entity\Data;
use App\Repository\DataRepository;
use Doctrine\ORM\EntityManagerInterface;

class InsertDataServiceORM
{
	public function __construct(
		private readonly DataRepository $data_repository,
		private readonly EntityManagerInterface $em,
		private readonly UtilsService $utilsService

	) {}
	public function insertDataORM(string $tableName, Data $data): string
	{
		try
		{
			if (!$this->utilsService->checkTableExistenceORM($tableName))
				return "danger: Table $tableName does not exist.";
			$this->em->persist($data);
			$this->em->flush();
			return "success: Data with ID " . $data->getId() . " inserted successfully!";
		}
		catch (Exception $e)
		{
			return "danger: Error inserting data with ID " . $data->getId() . ". " . $e->getMessage();
		}
	}
}

---
File: src/Service/InsertDataServiceSQL.php
---

<?php 

namespace App\Service;

use Exception;
use DateTimeInterface;
use Doctrine\DBAL\Connection;

class InsertDataServiceSQL
{
	public function __construct(
		private readonly Connection $sql_connection,
		private readonly UtilsService $utilsService) {}

	public function insertDataSQL(string $tableName, string $data, DateTimeInterface $date): string
	{
		$sql_command = "INSERT INTO $tableName (data, date) VALUES (:data, :date);";
		try
		{
			if (!$this->utilsService->checkTableExistenceSQL($tableName))
				return "danger: Table $tableName does not exist.";
			$this->sql_connection->executeStatement($sql_command, [
				'data' => $data,
				'date' => $date->format('Y-m-d H:i:s')
			]);
			return "success:Success! Data inserted into $tableName.";
		}
		catch (Exception $e)
		{
			return "danger:Error! Data could not be inserted into $tableName. " . $e->getMessage();
		}
	}
}
?>

---
File: src/Service/ReadDataServiceORM.php
---

<?php

namespace App\Service;

use Exception;
use App\Service\UtilsService;
use App\Repository\DataRepository;
use Doctrine\ORM\EntityManagerInterface;

class ReadDataServiceORM
{
	public function __construct(
		private readonly DataRepository $data_repository,
		private readonly EntityManagerInterface $em,
		private readonly UtilsService $utilsService

	) {}
	
	public function readAllDataORM(string $tableName): ?array
    {
        try
        {
			if (!$this->utilsService->checkTableExistenceORM($tableName))
				return [];
            return $this->data_repository->findAll();
        }
        catch (Exception $e)
        {
            return [];
        }
    }

	public function readDataORM(string $tableName, int $id)
	{
		try
		{
			if (!$this->utilsService->checkTableExistenceORM($tableName))
				return [];
			return $this->data_repository->find($id);
		}
		catch (Exception $e)
		{
			return [];
		}
	}


}

---
File: src/Service/ReadDataServiceSQL.php
---

<?php 

namespace App\Service;

use Exception;
use DateTimeInterface;
use Doctrine\DBAL\Connection;

class ReadDataServiceSQL
{
	public function __construct(
		private readonly Connection $sql_connection,
		private readonly UtilsService $utils_service) {}

	public function readAllDataSQL(string $tableName): ?array
	{
        $sql_command = "SELECT * FROM $tableName ORDER BY id ASC";
		try
		{
			
			return $this->sql_connection->fetchAllAssociative($sql_command);
		}
		catch (Exception $e)
		{
			return null;
		}
	}

	public function readDataByIdSQL(string $tableName, int $id): ?array
	{
		$sql_command = "SELECT * FROM $tableName WHERE id = :id";
		try
		{
			$data = $this->sql_connection->fetchAssociative($sql_command, ['id' => $id]);
			if ($data === false)
				return null;
			return $data;
		}
		catch (Exception $e)
		{
			return null;
		}
	}
}
?>

---
File: src/Service/UtilsService.php
---

<?php

namespace App\Service;

use Exception;
use Doctrine\DBAL\Connection;

class UtilsService
{
	public function __construct(
		private readonly Connection $connection,
	) {}

	public function checkTableExistenceSQL(string $tableName): bool
	{
		$sql_command = "SHOW TABLES LIKE '$tableName'";
		try
		{
			$result = $this->connection->fetchOne($sql_command);
			return ($result !== false);
		}
		catch (Exception $e)
		{
			return false;
		}
	}

	public function checkTableExistenceORM(string $tableName): bool
	{
		try
		{
			$schemaManager = $this->connection->createSchemaManager();
			return $schemaManager->tablesExist([$tableName]);
		}
		catch (Exception $e)
		{
			return false;
		}
	}
}
?>

================================================================================

ðŸ“‚ PUBLIC FILES (public/) - Location: ex10/public/
================================================================================


---
File: public/index.php
---

<?php

use App\Kernel;

require_once dirname(__DIR__).'/vendor/autoload_runtime.php';

return function (array $context) {
    return new Kernel($context['APP_ENV'], (bool) $context['APP_DEBUG']);
};


---
File: public/style.css
---

.alert
{
    padding: 1em 1.5em;
    margin: 1em 0;
    border-radius: 5px;
    font-weight: bold;
    box-shadow: 0 1px 7px #aaa1;
    font-size: 1em;
}

.alert-success
{
    background: #d4edda;
    color: #155724;
    border-left: 7px solid #38a169;
}

.alert-danger
{
    background: #f8d7da;
    color: #721c24;
    border-left: 7px solid #e53e3e;
}

.alert-info
{
    background: #ffee00;
    color: #000000;
    border-left: 7px solid #d8db38;
}
