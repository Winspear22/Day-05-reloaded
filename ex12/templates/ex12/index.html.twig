{% extends 'base.html.twig' %}

{% block title %}ex12 â€“ ORM Table Management{% endblock %}

{% block content %}
    <h1>ex12 â€“ ORM Table Management</h1>

    <div style="margin-bottom: 1em;">
        <form action="{{ path('ex12_create_all_tables') }}" method="post" style="display: inline;">
            <button type="submit" style="padding: 10px 20px; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer;">
                âœ“ Create all tables
            </button>
        </form>

        <form action="{{ path('ex12_load_demo_data') }}" method="post" style="display: inline; margin-left: 10px;">
            <button type="submit" style="padding: 10px 20px; background: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer;">
                âš¡ Fill tables with random data
            </button>
        </form>

        <form action="{{ path('ex12_delete_all_tables_content') }}" method="post" style="display: inline; margin-left: 10px;">
            <button type="submit" style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;" onclick="return confirm('Are you sure?')">
                ğŸ—‘ï¸ Delete all data
            </button>
        </form>
    </div>

    <div style="background: #f8f9fa; padding: 15px; border-radius: 4px; margin-bottom: 1.5em; border-left: 4px solid #6c757d;">
        <form method="get" action="{{ path('ex12_search') }}" style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
            <div>
                <input type="text" name="filter_name" value="{{ filterName is defined ? filterName : '' }}" placeholder="Filter by name" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
            </div>

            <div>
                <select name="sort_by" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="name" {% if sortBy is defined and sortBy == 'name' %}selected{% endif %}>Name</option>
                    <option value="email" {% if sortBy is defined and sortBy == 'email' %}selected{% endif %}>Email</option>
                    <option value="birthdate" {% if sortBy is defined and sortBy == 'birthdate' %}selected{% endif %}>Birthdate</option>
                </select>
            </div>

            <div>
                <select name="sort_dir" style="padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <option value="asc" {% if sortDirection is defined and sortDirection == 'asc' %}selected{% endif %}>Ascending</option>
                    <option value="desc" {% if sortDirection is defined and sortDirection == 'desc' %}selected{% endif %}>Descending</option>
                </select>
            </div>

            <button type="submit" style="padding: 8px 20px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                ğŸ” Apply
            </button>
        </form>
    </div>

    <h2>Persons + Addresses + Bank Accounts</h2>
    
    {% if results is defined and results|length > 0 %}
        <div style="overflow-x: auto; margin-bottom: 2em;">
            <table border="1" style="width: 100%;">
                <thead style="background: #343a40; color: white;">
                    <tr>
                        <th style="padding: 10px;">Id</th>
                        <th style="padding: 10px;">Username</th>
                        <th style="padding: 10px;">Name</th>
                        <th style="padding: 10px;">Email</th>
                        <th style="padding: 10px;">Enable</th>
                        <th style="padding: 10px;">Birthdate</th>
                        <th style="padding: 10px;">Addresses</th>
                        <th style="padding: 10px;">IBAN</th>
                        <th style="padding: 10px;">Bank Name</th>
                    </tr>
                </thead>
                <tbody>
                    {% for person in results %}
                        <tr style="background: {% if loop.index % 2 == 0 %}#f9f9f9{% endif %};">
                            <td style="padding: 10px;"><strong>{{ person.id }}</strong></td>
                            <td style="padding: 10px;">{{ person.username }}</td>
                            <td style="padding: 10px;">{{ person.name }}</td>
                            <td style="padding: 10px;">{{ person.email }}</td>
                            <td style="padding: 10px;">{{ person.enable ? 'Yes' : 'No' }}</td>
                            <td style="padding: 10px;">{{ person.birthdate|date('d/m/Y') }}</td>
                            <td style="padding: 10px;">
                                {% if person.addresses|length > 0 %}
                                    {% for address in person.addresses %}
                                        {{ address.address }}<br>
                                    {% endfor %}
                                {% else %}
                                    N/A
                                {% endif %}
                            </td>
                            <td style="padding: 10px; font-family: monospace; font-size: 0.9em;">
                                {{ person.bankAccount ? person.bankAccount.iban : 'N/A' }}
                            </td>
                            <td style="padding: 10px;">
                                {{ person.bankAccount ? person.bankAccount.bankName : 'N/A' }}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        <p style="color: #666;">{{ totalResults is defined ? totalResults : results|length }} result(s) found</p>
    {% elseif results is defined %}
        <div style="background: #fff3cd; padding: 15px; border-radius: 4px; border-left: 4px solid #ffc107; margin: 20px 0;">
            âš ï¸ No data found. Please create tables and fill them with random data first!
        </div>
    {% else %}
        <div style="background: #d1ecf1; padding: 15px; border-radius: 4px; border-left: 4px solid #17a2b8; margin: 20px 0;">
            â„¹ï¸ Please create tables and load demo data to start!
        </div>
    {% endif %}

{% endblock %}
